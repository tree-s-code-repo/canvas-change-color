<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <canvas id="myCanvas" width="500px" height="500px">Canvas!</canvas>

    <script>
      class CanvasImageEditor {
        ctx;

        constructor(canvasId, imagePath) {
          this.settinCanvas(canvasId);
          this.settingImage(imagePath);
        }

        settinCanvas(canvasId) {
          this.canvas = document.getElementById(canvasId);
          this.ctx = this.canvas.getContext("2d");
        }

        settingImage(imagePath) {
          this.image = new Image();

          this.image.onload = () => {
            this.startDrawImage();
          };
          this.image.src = imagePath;
        }

        startDrawImage() {
          this.ctx.drawImage(
            this.image,
            0,
            0,
            this.canvas.width,
            this.canvas.height
          );
          this.changeColor();
        }

        changeColor() {
          const imageData = this.ctx.getImageData(
            0,
            0,
            this.canvas.width,
            this.canvas.height
          );

          let data = imageData.data;
          this.putImageData(data, imageData);
        }

        putImageData(data, imageData) {
          this.processAllPixels(data);
          this.ctx.putImageData(imageData, 0, 0);
          requestAnimationFrame(this.changeColor.bind(this));
        }

        processAllPixels(data) {
          for (let i = 0; i < data.length; i += 4) {
            this.reverseColor(data, i);
          }
        }

        reverseColor(data, i) {
          if (data[i] === 255 && data[i + 1] === 255 && data[i + 2] === 255) {
            data[i] = 128; // R
            data[i + 1] = 128; // G
            data[i + 2] = 128; // B
          } else if (
            data[i] === 128 &&
            data[i + 1] === 128 &&
            data[i + 2] === 128
          ) {
            data[i] = 255; // R
            data[i + 1] = 255; // G
            data[i + 2] = 255; // B
          }
        }
      }

      window.onload = function () {
        const editor = new CanvasImageEditor("myCanvas", "./club.png");
      };
    </script>
  </body>
</html>
